<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>HTTP/2 Small Requests Test</title>
</head>
<body>
<h1>HTTP/2 Small Requests with ~900bytes+ Headers</h1>

<label for="reqCount">Number of requests:</label>
<input type="number" id="reqCount" min="1" max="1000" value="200">
<button id="startBtn">Start Requests</button>

<p id="status"></p>
<div id="log"></div>

<script>
function getQueryParam(name, defaultValue) {
  const urlParams = new URLSearchParams(window.location.search);
  const value = urlParams.get(name);
  return value ? parseInt(value, 10) : defaultValue;
}

async function makeRequests(count) {
  const log = document.getElementById("log");
  const status = document.getElementById("status");
  const requests = [];

  const headerFiller = "x".repeat(850);

  status.textContent = `Starting ${count} requests...`;
  log.textContent = "";

  for (let i = 0; i < count; i++) {
    requests.push(
      fetch(`./tiny.txt?req=${i}`, {
        headers: {
          "X-Fill-Header": headerFiller,
          "X-Req-Id": `${i}`
        }
      })
    );
  }

  const responses = await Promise.all(requests);
  status.textContent = `Completed ${responses.length} small requests successfully.`;
}

// On load, get value from URL or default to 200
const defaultCount = getQueryParam("count", 200);
document.getElementById("reqCount").value = defaultCount;

// Run automatically if URL param is present
if (window.location.search.includes("count")) {
  makeRequests(defaultCount);
}

// Or allow manual start
document.getElementById("startBtn").addEventListener("click", () => {
  const count = parseInt(document.getElementById("reqCount").value, 10);
  makeRequests(count);
});
</script>
</body>
</html>
