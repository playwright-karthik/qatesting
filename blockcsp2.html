<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSP Violation Test Modes</title>

  <script>
    // Parse mode from URL query param
    const params = new URLSearchParams(window.location.search);
    const mode = params.get("mode") || "child"; // default: child

    // Dynamically apply different CSP policies based on mode
    if (mode === "root") {
      // Root CSP: blocks inline scripts (this page will self-violate)
      document.write(`
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self';">
      `);
    } else if (mode === "redirect") {
      // Redirect CSP: allows navigation but will redirect to another page that violates CSP
      document.write(`
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'none';">
      `);
      // trigger redirect after short delay
      setTimeout(() => {
        window.location.href = window.location.origin + window.location.pathname + "?mode=redirect_target";
      }, 1000);
    } else if (mode === "redirect_target") {
      // Target page after redirect - will violate CSP immediately
      document.write(`
        <meta http-equiv="Content-Security-Policy" content="default-src 'none';">
      `);
    } else {
      // Child mode: block fonts or scripts (only sub-resources fail)
      document.write(`
        <meta http-equiv="Content-Security-Policy" content="default-src 'self'; style-src 'self' https://fonts.googleapis.com; font-src 'none';">
      `);
    }
  </script>

  <style>
    body { font-family: sans-serif; padding: 20px; }
    .mode { color: darkblue; font-weight: bold; }
    .error-hint { color: crimson; }
  </style>
</head>
<body>
  <h1>üîí CSP Violation Test</h1>
  <p>Current Mode: <span class="mode" id="modeText"></span></p>

  <script>
    document.getElementById("modeText").textContent = mode;

    if (mode === "root") {
      // This inline script will be blocked by CSP ‚Üí Root URL violation
      console.log("This inline script should be blocked!");
    } else if (mode === "child") {
      // Try to load a font that will be blocked ‚Üí Child violation
      const link = document.createElement("link");
      link.rel = "stylesheet";
      link.href = "https://fonts.googleapis.com/css2?family=Roboto&display=swap";
      document.head.appendChild(link);
      document.body.insertAdjacentHTML("beforeend",
        `<p class="error-hint">Expect a CSP error for blocked font (child resource).</p>`);
    } else if (mode === "redirect_target") {
      // Hard CSP block on redirected page
      fetch(window.location.href)
        .catch(e => console.error("Blocked by CSP:", e));
      document.body.insertAdjacentHTML("beforeend",
        `<p class="error-hint">This is the redirected page. Expect immediate CSP block.</p>`);
    } else if (mode === "redirect") {
      document.body.insertAdjacentHTML("beforeend",
        `<p>Redirecting shortly to trigger redirect CSP violation...</p>`);
    }
  </script>

  <hr>
  <h3>üîÅ Quick Links to Test Modes</h3>
  <ul>
    <li><a href="?mode=child">Child Resource CSP Violation</a></li>
    <li><a href="?mode=root">Root Inline Script CSP Violation</a></li>
    <li><a href="?mode=redirect">Redirect + Root CSP Violation</a></li>
  </ul>

  <p><b>Note:</b> Open DevTools ‚Üí Console/Network to verify which request was blocked by CSP.</p>
</body>
</html>
