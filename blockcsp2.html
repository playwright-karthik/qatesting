<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CSP Simulation Test Modes</title>

  <script>
    const params = new URLSearchParams(window.location.search);
    const mode = params.get('mode') || 'pass';

    // Inject CSP meta dynamically based on mode
    function setCSP(policy) {
      const meta = document.createElement('meta');
      meta.httpEquiv = "Content-Security-Policy";
      meta.content = policy;
      document.head.appendChild(meta);
    }

    switch (mode) {
      case 'root':
        // Completely block all resource loads (simulates Root URL fail)
        setCSP("default-src 'none';");
        break;
      case 'redirect':
        // Allow initial load but redirect immediately
        setTimeout(() => {
          window.location.href = "https://example.com"; // simulate redirect to disallowed domain
        }, 1000);
        setCSP("default-src 'self'; script-src 'none';");
        break;
      case 'child':
        // Allow page itself but block external fonts or images
        setCSP("default-src 'self'; font-src 'none'; img-src 'none';");
        break;
      case 'pass':
      default:
        // Allow all + add extra child resources to verify document complete
        setCSP("default-src * 'unsafe-inline';");
        break;
    }
  </script>

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h1 {
      color: darkgreen;
    }
    .info {
      background: #eef;
      border-left: 5px solid #66f;
      padding: 10px;
      margin-top: 15px;
    }
  </style>
</head>
<body>
  <h1>CSP Simulation Test</h1>
  <div class="info">
    <p><b>Mode:</b> <span id="modeText"></span></p>
    <p>This test page simulates different CSP behaviors.</p>
  </div>

  <p id="desc"></p>

  <!-- Child requests for testing -->
  <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a7/React-icon.svg/64px-React-icon.svg.png" alt="React Logo" width="64" height="64">
  <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <script>
    const desc = document.getElementById('desc');
    const modeText = document.getElementById('modeText');
    modeText.textContent = mode.toUpperCase();

    switch (mode) {
      case 'root':
        desc.textContent = "Root mode: Entire document should fail to load due to CSP 'default-src none'.";
        break;
      case 'redirect':
        desc.textContent = "Redirect mode: Page will attempt to redirect to example.com (simulating CSP failure after redirect).";
        break;
      case 'child':
        desc.textContent = "Child mode: Root loads fine, but external fonts/images/scripts are blocked (CSP violation visible in console).";
        break;
      case 'pass':
        desc.textContent = "Pass mode: Everything loads properly, including images, fonts, and scripts.";
        // Load additional children to show document completeness
        const extraImg = document.createElement('img');
        extraImg.src = "https://placekitten.com/200/200";
        document.body.appendChild(extraImg);
        break;
      default:
        desc.textContent = "Unknown mode. Defaulting to pass behavior.";
    }

    console.log(`CSP test running in mode: ${mode}`);
  </script>
</body>
</html>
